# 6. データベース

## 6.1 データベースの基礎

### 6.1.1 データベースの種類

- 階層型データベース
- 網型データベース
- 関係データベース

#### 階層型データベース

- 木構造によりデータの構造を表現
- 親レコードと子レコードを結ぶポインタをたどることで1つのデータを取り出すことができる
- 1 (親) 対 多 (子)

#### 網型データベース (ネットワーク型データベース)

- 多対多 (親は複数の子を、子も複数の親を持つことができる) の関係

#### 関係データベース (リレーショナルデータベース)

- 2次元の表で表現
- 階層関係を持たない
- **結合**によってデータを関連づける
  - 主キーと外部キーの値の一致を用いて関連付けられる

### 6.1.2 データベースの設計

#### データベースの設計プロセス

1. 概念設計
2. 論理設計
3. 物理設計

#### 概念設計

- データを分析し、抽象化した**概念データモデル**を作成
  - データの意味を崩さず一定のルールの下で表現
  - 特定の DBMS (Database Management System) に依存しない
- E-R モデル (Entity Relationship Model) や UML のクラス図を用いて記述

##### データ分析

1. どのようなデータがあるかを洗い出す
2. 洗い出したデータを一定の基準に従って標準化 (データ項目の標準化)
3. 各データ間の関連を明確にする (正規化)

- シノニム (異音同義語) や ホモニム (同音異義語) の排除
- データの重複の排除

##### トップダウンアプローチとボトムアップアプローチ

- トップダウン
  1. 理想型の概念データモデルを作成
  2. データ分析
- ボトムアップ
  1. 画面や帳票から項目を洗い出しデータ分析
  2. 概念データモデルを作成

#### 論理設計

- 概念データモデルを**論理データモデル**に変換
  - 概念データモデルと論理データモデルを区別せず、論理データモデルとまとめることもある
- データベースの種類に対応して、以下のような論理データモデルの形式がある
  - 階層モデル
  - ネットワーク (網) モデル
  - 関係モデル
    - 主キーや外部キーを含めたテーブル構造を作成
    - 各列が満たすデータの制約
    - ビューの設計

#### 物理設計

- 論理データモデルに基づいた特定の DBMS を用いて物理的構造を決定する
  - 実際に磁気ディスクに記憶される形式などを定める
- データ量、データの利用頻度、パフォーマンス、運用面を考慮する

### 6.1.3 データベースの3層スキーマ

#### スキーマ

- データの性質、形式、ほかのデータとの関連などのデータ定義の集合

#### ANSI / SPARC 3層スキーマ (American National Standards Institute, Standards Planning And Requirements Committee)

- 論理的なデータとユーザーから見たデータとの独立 (論理データ独立性)
- 記憶装置との独立性 (物理データ独立性)

| スキーマの種類 | 説明                                                         |
| -------------- | ------------------------------------------------------------ |
| 外部スキーマ   | ユーザーやアプリケーションプログラムから見たデータの定義<br />ビュー、CODASYL モデル (網型データベース) のサブスキーマがこれに対応 |
| 概念スキーマ   | データの論理的構造とその内容を定義<br />論理設計段階の論理データモデルがこれに対応 |
| 内部スキーマ   | 記憶装置上にどのようにデータを記録するかの物理的内容を定義<br />セキュリティや耐障害性を考慮し、実際の格納表現の記述 |

#### NoSQL (Not only SQL)

- アクセス方法を SQL に限定しない DBMS
- スキーマレス
- 例) キーバリュー型 (KVS / Key-Value System)、ドキュメント指向型 (ドキュメント (準構造化データ単位) で管理)

### 6.1.4 E-R 図 (Entity-Relationship Diagram)

#### E-R 図の構成要素

- 実体 (**entity**)
  - 属性 (attribute)
  - 主キー
    - 一意に識別可能
- 関連 (relationship)
  - エンティティ間の関係

1対1 や多対多などのように対応関係を表したものをガーディナリティという

#### 多対多

- そのままでは関係データベースでは実装できないので、1対多と多対1に分解する
- リレーションシップを1つのエンティティ (**通関エンティティ**) とし、それぞれの識別子 (外部キー) と交差データを保持する
  - リレーションシップ (通関エンティティ) も属性を持ちうる (交差データ)

#### 1対多

- 「多」のエンティティは「1」のエンティティの識別子を属性として持つ
- 「多」のエンティティは「1」のエンティティに依存し、「1」のエンティティなしでは存在しえない**依存エンティティ (弱実体) **になる
- 「多」のエンティティに新たに主キーとなる属性を導入した場合は**独立エンティティ (強実体) **となる