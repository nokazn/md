# 8. セキュリティ

## 8.1 暗号化

- 暗号化
  - 復号可能
  - RSA, DSA, ECDSA
- ハッシュ化
  - 復号不可
  - MD5, SHA1

### 8.1.1 暗号化に必要な要素

- 暗号化の基本
  - 平文を暗号化できるルール (キー)
  - 暗号を復号できるルール (キー)
- 必要な要素
  - キーを不正に入手できないよう管理
  - 変換ルールを複雑して推測されにくくする

### 8.1.2 暗号化方式の種類

#### 共通鍵暗号方式

- 暗号・復号するキーが同一
- 送信者と受信者のキーが同一 (共通鍵)
- 通信相手の分だけ鍵が必要で、管理や配布の負担が大きい
  - n 人の相手に対して $ _nC_2 = \frac{1}{2}n(n-1) $ の共通鍵が必要
- 分割の仕方
  - ブロック暗号
    - 一定のブロックごと
  - ストリーム暗号
    - 1bit ごと

##### 実装方式

- DES (Data Encrypted Standard)
  - $  2^{56} $ のパターン
  - 8 バイトごとに分割し、キーによる変換処理を16回行う
- AES (Advanced Encryption Standard)
  - DES がコンピューターの性能向上により総当たりされそうなので作られた
- トリプルDES
- FEAL
- IDEA

#### 公開鍵暗号方式

- 暗号・復号するキーが別
- 暗号化キー (公開鍵) は公開し、復号化キー (秘密鍵) は受信者が生成し、管理
- 受信者は1つの秘密鍵をもっていればよい
  - n 人の相手に対して $ 2n $ の公開鍵が必要
- 演算が共通鍵暗号に比べて複雑

##### 実装方式

- RSA (Rivest–Shamir–Adleman)
  - 大きな値の素因数分解にかかり時間が膨大なことを利用
- ECDSA (楕円曲線暗号 / Elliptic Curve Digital Signature Algorithm)
  - 楕円曲線上の演算規則を利用
- ElGamal (エルガマル暗号)
  - 離散対数問題を応用

#### ハイプリッド方式

- 公開鍵暗号 + 共通鍵暗号
- データ本文には共通鍵で暗号化し、共通鍵の受け渡しに公開鍵暗号方式を用いる
- 公開鍵暗号が演算の負荷が大きいのに対処し、速度と強度を確保
- [S/MINE](TODO) や [PGP](TODO)、[SSL/TSL](TODO) に用いられる

## 8.2 無線 LAN の暗号

### 8.2.1 無線 LAN の規格

- 電波や赤外線を利用

- IEEE802.11 シリーズの規格

- MIMO (Multiple-Input and Multiple-Output)

  - 複数アンテナで送受信し、高速化
  - 11n, 11ac で用いられる

- ESSID (Extended Service Set Identifier)

  - SSID の発展形
  - 最大32文字の識別子

- セキュリティ対策

  - MAC アドレスフィルタリング
  - ステルスモード
    - ESSID を公に通知しない

| 規格         | 速度    | 周波数     | 特徴                       |
| ------------ | ------- | ---------- | -------------------------- |
| IEEE802.11b  | 11Mbps  | 2.4GHz     | 早くから普及               |
| IEEE802.11a  | 54Mbps  | 5GHz       |                            |
| IEEE802.11g  | 54Mbps  | 2.4GHz     | 11b と上位互換             |
| IEEE802.11n  | 600Mbps | 5 / 2.4GHz | 11a, 11g (←11b) と上位互換 |
| IEEE802.11ac | 7Gbps   | 5GHz       | 11a. 11n と上位互換        |

- 2.4GHz (**b → g → n**)
  - 11b
  - 11g (← 11b)
  - 11n (← 11g)
- 5GHz (**a → n → ac**)
  - 11a
  - 11n (← 11a)
  - 11ac (← 11a, 11n)

### 8.2.2 無線 LAN における通信の暗号化

#### WEP (Wired Equivalent Privacy)

- WEP キーという**共通鍵**でアクセスポイント~クライント間で送受信されるパケットを暗号化
  - アクセスポイントに接続しているクアイント内で共通
- 11b で規定された

#### WPA / WPA2

- WPA (Wi-Fi Protected Access)
  - WEP キー
  - ESSID (ユーザー認証のしくみ)
  - **TKIP** (Temporal Key Integrity Protocol)
    - セッションごとに暗号鍵を更新
  - 暗号化アルゴリズムは RC4 (Rivest Cipher 4)
    - ストリーム暗号の共通鍵暗号方式
- WPA2 (Wi-Fi Protected Access 2)
  - 暗号化アルゴリズムは AES (Advanced Encryption Standard)
    - 最大で 256bit 鍵を扱える
    - RC4 より安全

##### 認証モード

- パーソナルモード
  - 事前共有鍵 (PSK / Pre-Shared Key) を用いる
  - 特に WPA / WPA2 のパーソナルモードを WPA-PSK / WPA2-PSK という
- エンタープライズモード
  - [IEE802.1X](TODO) を使う

## 8.3 認証

- コンピュータを利用するユーザが利用権限を持っているかを確認する

### 8.3.1 利用者認証

#### 固定式認証方式 (パスワード認証)

| 攻撃                            | 特徴                         | 対策                     |
| ------------------------------- | ---------------------------- | ------------------------ |
| 辞書攻撃                        | 辞書内の単語で総当たり       | 辞書内の単語は使用しない |
| ブルートフォース攻撃 (総当たり) | 文字を組み合わせて何度も試行 | 試行回数に制限を設ける   |

#### チャレンジレスポンス認証

ネットワーク上でパスワード認証をする際の脆弱性を解消

1. クライントがユーザ ID を送信
2. サーバがチャレンジコード (使い捨ての乱数) を送信
3. クライントが**パスワードとチャレンジコードから生成したハッシュ値**を送る
4. サーバーは手元で計算したハッシュ値とクライアントから送られたハッシュ値を比較し、認証

##### 実装方式

- [PPP](TODO)
- [CHAP](TODO)

#### ワンタイムパスワード (OTP)

- 認証のときのみ有効な使い捨てのパスワードを用いる

##### 実装方式

- 時刻同期方式
  - 認証時のタイムスタンプを基にワンタイムパスワードを生成し、認証
- S/KEY 方式
  - サーバーから送られたシードとシーケンス番号 (認証ごとに1ずつ減らす) で認証

#### シングルサインオン

一度だけユーザ認証を行えば許可された複数のサーバにもアクセスできる

##### Cookie 型

サーバから送信された認証情報を Cookie で保持し、認証

##### リバースプロキシ型

- 共通のリバースプロキシサーバから各サーバにアクセス
- 認証はリバースプロキシサーバが代行
- パスワードの代わりにデジタル証明書も用いることができる

##### SAML 型

- 認証情報、に加え属性やアクセス権限情報を他ドメインに伝えるための仕様
- XML

### バイオメトリクス認証 (生体認証)

個人の身体的・行動的特徴を用いて認証

- 指紋認証
  - 指紋の形を位相として入力した画像を特殊点抽出方式やパターンマッチングで照合
- 声紋認証
  - 声の波形で識別
  - 風邪や加齢により変化しうる
- 虹彩認証
  - 角膜と水晶体の間にある虹彩の紋様
  - 虹彩は経年による変化がない

#### その他の利用者認証

| 認証             | 特徴                                                        |
| ---------------- | ----------------------------------------------------------- |
| リスクベース認証 | 普段とは異なる環境からのアクセスに対し追加で認証            |
| Kerberos 方式    | 最初はパスワードで認証し、以降はチケットで識別 (SSO に対応) |
| 2要素認証        | 知識 (know)・所有 (have)・特徴 (be) のうち2要素で認証       |
| CAPTCHA 認証     | 画像や文字を判読させて人間以外の入力を除外                  |

### 8.3.2 リモートアクセス

- 公衆回線網を通じて遠隔地から LAN やコンピュータに接続する
- LAN 上のリモートアクセスサーバで認証した後アクセスできる
- セキュリティ上の弱点になりやすい

#### PPP (Point to Point Protocol) の認証技術

- 電話回線で二点間の通信を行うための[データリンク層](TODO)のプロトコル
- [HDLC](TODO) 手順がベース
- IP 以外のパケットも伝送可能

##### 種類

- NCP (Network Control Protocol)
  - ネットワーク層の設定をネゴシエーション
  - 上層と
- LCP (Link Control Protocol)
  - リンク制御
  - 通信相手と

##### 認証プロトコル

- PAP (Password Authentication Protocol)
  - 平文のままパスワードを送信
- CHAP (Challenge Handshake Authentication Protocol)
  - PAP の盗聴の脆弱性に対応
  - チャレンジレスポンス方式

### 8.3.3 RADIUS 認証

#### RADIUS (Remote Authentication Dial-In User Service)

- アクセスサーバ (Radiusクライアント)
- 認証サーバ (RADIUSサーバ)

#### IEEE802.1X

- イーサーネットや無線LANの規格
- 認証のしくみは RADIUS
  - 認証プロトコルは EAP (Extended Authentication Protocol)
    - EAP-TLS
    - EAP-MD5

## 8.4 ディジタル署名と KPI

### 8.4.1 ディジタル署名

- 改竄やなりすましを防止
- 否認防止

#### 基本的なしくみ

- 送信者が秘密鍵と公開鍵を生成し、公開鍵を配布
- 暗号鍵を秘密鍵にし、復号鍵を公開鍵とする
  - 配布された公開鍵で復号できれば本人のものと確認できる
- 平文をハッシュ化 (メッセージダイジェスト) して署名をつくる

#### メッセージダイジェスト

- 可変長の平文に対して固定長のメッセージダイジェストを生成するハッシュ演算を行う
- 得られた固定長のメッセージダイジェストからディジタル署名を作成する

#### ハッシュ関数

- MD2
  - 128bit
- MD5
  - MD2 を高速化

- SHA-1
  - 160bit
- SHA-2
  - SHA-1 の発展
- SHA-256
  - 256bit

### 8.4.2 PKI

- PKI (Public Key Infrastructure / 公開鍵基盤)
  - 認証局 (CA) がディジタル署名を利用したディジタル証明書 (公開鍵証明書) を発行
  - 公開鍵の正当性を保証する
  - 公開鍵の管理・配布等を CA が取り持つ

### 8.4.3 SSL/TLS

- 公開鍵基盤を利用した安全な通信を実現
- SSL (Secure Sockets Layer)
- TLS (Transport Layer Security)
  - SSL の後継

- 登録
  1. Webサーバが CA に申請
  2. CA がサーバ証明書 (ディジタル証明書) を発行
- 通信
  1. クライントが Web サーバに接続
  2. Web サーバはサーバ証明書を返却
  3. クライアントはブラウザ等に格納されている CA の認証情報と照合し、サーバ証明書の正当性を確認
  4. 暗号鍵の基になる乱数を生成し、サーバ証明書に組み込まれた公開鍵で暗号化して Web サーバに送る
  5. Web サーバは秘密鍵で乱数を復号
  6. サーバ・クライアントでそれぞれマスターシークレット (MS) という鍵を生成し、得られた別々の共通鍵で暗号化通信する

暗号化通信自体は共通鍵で、共通鍵の生成に公開鍵を使用

## 8.5 情報セキュリティ対策

### 8.5.1 コンピュータウイルス

#### 定義

- 自己伝染 (増殖)
- 潜伏
- 発病

#### 分類

- ウイルス (広義)
  - ウイルス (狭義)
    - 他のプログラムに寄生
  - ワーム
    - 独立して破壊活動、自己増殖
  - トロイの木馬
    - 一見有用だが有害

#### 経路

- セキュリティホール
  - OS などに存在するセキュリティ上の弱点
- バックドア
  - システム上の抜け道から侵入し、その後入りやすくする
- マクロ
  - 表計算ソフトなどの機能を使ったウイルス

#### 対策

- ウイルスチェックソフト
  - 過去のウイルス情報を保持している**パターンファイル**を照合してチェック
  - 最新のウイルスには対応できない
- セキュリティパッチ
  - セキュリティホールの修正
- ビヘイビア法 (動的ヒューリスティック法)
  - サンドボックス (仮想環境) 内で実行し、挙動を監視して検知
  - 未知のウイルスや**ポリモーフィック型ウイルス**にも有効
    - 感染するごとに自らを変化させるウイルス
    - 鍵を変えてウイルスのコードを暗号化

### 8.5.2 ネットワークセキュリティ

#### ファイアウォール

- ローカルネットワークの境界に設置
- 不正なデータの通信を阻止
- ルールベース
  - フィルタリングを行うルールの集合
  - 最後のルールに**原則拒否の方針**

#### 種類

- パケットフィルタリング型
  - ネットワーク層 (3)
  - IP アドレス、ポート番号をチェック
- サーキットレベルゲートウェイ型 (トランスポートゲートウェイ)
  - トランスポート層 (4)
  - セグメントレベルのフィルタリング
- アプリケーションゲートウェイ型
  - アプリケーション層 (5~7)

#### プロキシサーバ

- アプリケーションゲートウェイ型ファイアウォール
- HTTP を扱う
- 内から外
- キャッシュ
- ローカルネットワーク内に置かれる

#### リバースプロキシサーバ

- 外から内
- DMZ 内に置かれる
  - ファイアウォールの内外に追加される第3のエリア
  - インターネットに公開するサーバに対して適用

#### WAF (Web Application Firewall)

- Web アプリケーションへのアクセスを監視する
- DoS 攻撃、SQLインジェクションなどの対策

##### 種類

- ホワイトリスト方式
- ブラックリスト方式

#### TLS アクセラレータ

- Web サーバの代わりに負荷の大きい TLS の復号処理を担う
- インターネット → ファイアウォール → TLS アクセラレータ → WAF → Web サーバ
  - WAF と Web サーバは HTTP 通信

#### セキュリティ対策機器

- 侵入検知システム (IDS / Intrusion Detection System)
  - NIDS (ネットワーク型 IDS)
    - 管理下のネットワークを監視
    - 不正な通信量やパケット
  - HIDS (ホスト型 IDS)
    - ホストマシンにインストールしてホストみを監視
  - IPS (侵入防止システム / Intrusion Prevention System)
    - 不正パケットの検出 + 検出した際通信を遮断
    - DoS 攻撃に有効
  - ハニーポット
    - ダニーのサーバやネットワーク機器
- SIEM (Security Information and Event Management)
  - ネットワーク機器やサーバの様々なログを一元管理し、分析するシステム

##### 不正検知方法

- シグネチャ方式
  - 既知の攻撃パターンを照合して検出
  - フォールスネガティブ (検知漏れ) が起きうる
- アノマリー方式
  - 正常のパターン以外をすべて異常とみなす
  - フォールスポジティブ (誤検知) が起きうる

#### VPN (Virtual Private Network)

- インターネットを専用線のように用いる
- IP-VPN
  - 通信事業者の広域 IP 網を使用する VPN

##### モード

- トランスポートモード
  - 全経路を端末が直接暗号化
  - ペイロードのみ暗号化し、IPアドレス等は暗号化されないので盗聴のリスクあり
- トンネルモード
  - VPN ゲートウェイ間を暗号化
  - IPsec を利用して IP パケット暗号化してから送信され、受信側のゲートウェイが復号して本来の送信先へ転送

#### プロトコル

- IPsec (IP Security)
  - ネットワーク層で IP パケットを暗号化
  - 通常の IP ヘッダにはないフィールド
    - AH (Authentication Header)
      - 認証
    - ESP (Encapsulating Security Payload)
      - 認証
      - 暗号化
  - IKE (Internet Key Exchange) フェーズ
    - 通信開始前に暗号化方式の決定と鍵交換を行うフェーズ
- PPTP (Point to Point Tunneling Protocol)
  - データリンク層で暗号化や認証を行う
  - ネットワーク層のプロトコルを利用していて IPsec が採用できないときに有効
  - cf. [PPP](TODO)
- SSL/TLS

## 8.6 情報セキュリティの脅威と攻撃手法

### 8.6.1 セキュリティのとらえ方

- 機密性 (Confidentiality)
  - 正当なユーザのみアクセスできる
- 完全性 (Integrity)
  - 情報が改竄、破壊されていない
- 可用性 (Availability)
  - ユーザが必要なときに利用可能なことを保証

cf. [RASIS](TODO)

### 8.6.2 脅威

#### 不正アクセス

- ポートスキャン
  - 全ポートにパケットを送って応答の有無からサービス構成を推定
- セキュリティホール攻撃
  - システムの脆弱性をつく
  - バッファオーバーフロー攻撃が多い
    - 許容量以上のデータを送り、乗っ取りや踏み台にしたりする

### 8.6.3 攻撃手法

| 手法                               | 特徴                                                         |
| ---------------------------------- | ------------------------------------------------------------ |
| IPスプーフィング                   | IP アドレス偽装                                              |
| ARPスプーフィング                  | ARP の MAC 問い合わせに不正な MAC アドレスを返す             |
| バッファオーバーフロー攻撃         | 許容範囲を超えるデータを送りつける                           |
| ディレクトリトラバーサル攻撃       | 相対パスで公開されていないファイルにアクセス                 |
| SQLインジェクション                | 入力に SQL 文を入れて不正な操作をする<br />- サニタイジング (特別な意味を持つ文字を無効にする)<br />- バインド機構 (プレースホルダ (変数) を用いた SQL 文を用意して組み立てる) |
| OSコマンドインジェクション         | 不正にシェルスクリプトを実行させる                           |
| フィッシング                       | 実際のサイトを装って誘導                                     |
| DNSキャッシュポイズニング          | 偽のドメイン情報を DNS サーバに覚えさせる<br />外部ネットワークから再帰的問合せに応じる際コンテンツサーバより早く偽の情報をキャッシュサーバに返す<br />cf. カミンスキーアタック |
| クロスサイトスクリプティング (XSS) | 入力に悪意のあるスクリプトを埋め込む                         |
| SEO ポイズニング                   | 悪意のあるサイトを検索上位に表示させる                       |
| DoS 攻撃                           | 大量に要求を行う                                             |
| DNS amp 攻撃                       | DDoS 攻撃<br />DNS キャッシュポイズニング脆弱性のある DNS キャッシュサーバに送り、偽装した IP から大量に要求を行う |
| NTP 増幅攻撃                       | NTP サーバを踏み台とした攻撃<br />偽装した monlist 要求を NTP サーバに送り大量のリクエストを送る |
| Smurf 攻撃                         | 偽装した ICMP エコー要求パケット (`ping`) を攻撃先にブロードキャストで送る |
| ICMP Flood 攻撃                    | 偽装した ICMP エコー要求パケット (`ping`) をボットで大量に送る |
| 標的型攻撃                         | 特定の組織や個人に行われる攻撃<br />APT (Advanced Presistent Threats) - 執拗に継続的に行う |
| 水飲み場攻撃                       | ユーザが頻繁に利用するサイトに罠を仕掛ける                   |
| SSL/TLS のダウングレード攻撃       | 暗号化通信確立時に通信時に介在し、脆弱性のある暗号スイートの使用を強制させる |
| 中間者攻撃                         | 通信社同士の間に割り込んで改竄・盗聴した後転送する           |
| リプレイ攻撃                       | 盗聴して得た認証情報を用いてログイン                         |
| MITB攻撃                           | コンピュータに侵入させたマルウェアでブラウザ通信を乗っ取る   |
| ドライブバイダウンロード攻撃       | サイト閲覧時に不正プログラムを密かに転送させる               |
| スパムメール                       | 不特定多数のユーザに電子メールを送る行為<br />SPF, DKIM, OP25B などで対策 |
| ソーシャルエンジニアリング         | アナログな方法で機密情報を不正に入手                         |
| EDoS                               | 従量課金制のクラウドリソースを大量に使用させる               |
| パスワードリスト攻撃               | 利用者 ID とパスワードのリストを用いて他のサイトにアクセス   |
| レインボーテーブル攻撃             | 予めパスワードになりそうな単語のハッシュ値を計算し、管理しているテーブルで攻撃 |
| サイドチャンネル攻撃               | 処理時間等から暗号アルゴリズムを推測する                     |
| RTTrap                             | 文字の並び順を変える Unicode の制御文字 RLO を悪用してファイル名を偽装する |
| エクスプロイトコード               | ソフトウェアやハードウェアの脆弱性の存在を再現・検証するプログラム |

## 8.7 情報セキュリティ管理

### 8.7.1 リスクマネジメント

- リスクマネジメント
  - リスク分析
  - リスク対応
    - リスクコントロール
    - リスクファイナンス

#### リスク分析

1. 分析対象の理解と計画
2. 脆弱性の発見
3. 事故態様の関連分析・損失額予想
4. 損失の分類と影響度の評価
5. 対策の検討・評価と優先順位の決定

#### リスク対応

- リスクコントロール
  - リスク回避
  - リスク最適化
    - 一般的なセキュリティ対策
  - リスク移転
  - リスク保有
    - 対応コストが損失コストを上回る場合
- リスクファイナンス
  - リスク保有
  - リスク移転

### 8.7.2 セキュリティ評価の標準化

### リスク対応

- 製品のセキュリティの国際標準
  - ISO/IEC 15408
    - PP (Protection Profile)
    - ST (Security Target)
  - CC (コモンクライテリア)
  - JIS X 5070

#### ISMS (Information Security Management Standard) の規格

- 組織のセキュリティの国際基準
  - ISO/IEC 27001
- ベースラインアプローチ
  - 一般に公開されている基準やガイドライン，チェックリストを使用して**簡易的に**リスク分析を行う手法

##### PDCA

- Plan
- Do
- Check
- Action

#### 情報セキュリティポリシ

組織内のセキュリティ基準

- 基本方針
- 対策基準
- 実装手順

#### 情報セキュリティ組織・機関

- CSIRT
  - セキュリティインシデントの調査を行う機関の総称
- JPCERT/CC
  - 日本の代表的な CSIRT
- J-CART
  - IPA が設置した組織
- CRYPTREC
  - 電子政府推奨暗号の安全性を評価・監視し，暗号技術の適切な実装法・運用法を調査・検討するプロジェクト
  - 経産省・総務省
- NICS
  - 内閣官房に設置され，我が国をサイバー攻撃から防衛するための司令塔機能を担う組織
